---
- hosts: db
  tasks: 
    - name: uplaod a file to the target if it doesn't exist
      copy:
        src: /opt/program1.sh
        dest: /home/ansible/program1.sh
        mode: 0755
    - name: if line is not there then add it
      lineinfile:
        state: present
        dest: /home/ansible/program1.sh
        regexp: '^HOSTNAME='
        line: HOSTNAME={{ansible_hostname}}
    - name: run the program
      shell: /home/ansible/program1.sh
      register: program_output
    - debug: msg="stdout={{program_output}}"
